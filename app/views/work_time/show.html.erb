<%=javascript_include_tag "work_time", :plugin=>'redmine_work_time' %>
<%=stylesheet_link_tag 'work_time', :plugin => 'redmine_work_time' %>

<%= @message.html_safe %>
<div class="contextual">
<%= render :partial=>'select_project' %>
<%if User.current.allowed_to?(:view_work_time_other_member, @project) then%>
  <%= render :partial=>'select_user', :locals=>{:link_params=>@link_params} %>
  <%= link_to(l(:wt_relay_total), @link_params.merge(:action=>"relay_total")) %>
<%end%>
  <%if User.current.admin then%>
      <%if WtHolidays.where(["holiday=:h and deleted_on is null",{:h=>@this_date}]).all.size == 0 then %>
          <input type="button"
                 onclick="location.href='<%=url_for(@link_params.merge(:set_holiday=>@this_date))%>'"
                 value="<%=l(:wt_set_holiday)%>"
          />
      <%else%>
          <input type="button"
                 onclick="location.href='<%=url_for(@link_params.merge(:del_holiday=>@this_date))%>'"
                 value="<%=l(:wt_del_holiday)%>"
          />
      <%end%>
  <%end%>
</div>

<%= render :partial=>'user_month_table' %>

<br/>

<%= form_tag @link_params do %>
    <h2>
      <%=l(:wt_daily_report)%>
      <%=@this_date.strftime("%Y-%m-%d")%>
    </h2>

    <%= hidden_field_tag('year', @this_date.year) %>
    <%= hidden_field_tag('month', @this_date.month) %>
    <%= hidden_field_tag('day', @this_date.day) %>
    <%= hidden_field_tag('user', @this_uid) %>
    <%= hidden_field_tag('prj', @restrict_project) %>

    <table style="background: #eeeeee;"><tr><td>
      <table style="display:inline-block; border:0;">
        <tr>
          <td><%=l(:wt_legend)%>:</td>
          <td class='wt_iss_default' width='100px' align='center'><%=l(:wt_style_default)%></td>
          <td class='wt_iss_assigned' width='100px' align='center'><%=l(:wt_style_assigned)%></td>
          <td class='wt_iss_worked' width='100px' align='center'><%=l(:wt_style_worked)%></td>
          <td class='wt_iss_assigned_worked' width='100px' align='center'><%=l(:wt_style__assigned_worked)%></td>
          <td class='wt_iss_overdue' width='100px' align='center'><%=l(:wt_style_overdue)%>
          <td class='wt_iss_assigned_overdue' width='100px' align='center'><%=l(:wt_style_assigned_overdue)%>
          </td><td class='wt_iss_overdue_worked' width='100px' align='center'><%=l(:wt_style_overdue_worked)%></td>
          <td class='wt_iss_assigned_overdue_worked' width='100px' align='center'><%=l(:wt_style_assigned_overdue_worked)%></td>
        </tr>
      </table>
    </td></tr></table>
    <%= render :partial=>'user_day_table' %>

<%if @this_uid==@crnt_uid || User.current.allowed_to?(:edit_work_time_other_member, @project) %>
    <input type="button" onclick="$(window).off('beforeunload'); window.onbeforeunload = null; submit();" value="<%= l(:wt_update) %>" />
<%end%>

<%end%>
